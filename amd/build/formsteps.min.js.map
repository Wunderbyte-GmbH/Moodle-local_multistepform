{"version":3,"file":"formsteps.min.js","sources":["../src/formsteps.js"],"sourcesContent":["/**\n * JS for handling AJAX-based form step loading.\n *\n * @module local_multistepform/formsteps\n * @copyright 2025\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n// import Ajax from 'core/ajax';\nimport * as notification from 'core/notification';\nimport DynamicForm from 'core_form/dynamicform';\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\n\nconst SELECTORS = {\n    FORMCONTAINER: '[data-region=multistepformcontainer]',\n    MULTISTEPFORMCONTAINER: 'div.multistep-form-wrapper',\n};\n\nvar dynamicForm = null;\nvar currentstep = 0;\n\nexport const init = (uniqueid, initialstep, formclass, data) => {\n\n    // eslint-disable-next-line no-console\n    console.log('start with step', uniqueid, initialstep, formclass, data);\n\n    // eslint-disable-next-line no-console\n    console.log('selector', SELECTORS.MULTISTEPFORMCONTAINER + '[data-uniqueid=\"' + uniqueid + '\"]');\n\n    const multiformcontainer = document.querySelector(\n        SELECTORS.MULTISTEPFORMCONTAINER + '[data-uniqueid=\"' + uniqueid + '\"]');\n    if (!multiformcontainer) {\n        // eslint-disable-next-line no-console\n        console.log('multiformcontainer not found');\n        return;\n    }\n\n    currentstep = initialstep;\n\n    multiformcontainer.querySelectorAll('[data-step]').forEach(button => {\n        button.addEventListener('click', e => {\n\n            const direction = e.currentTarget.getAttribute('data-step');\n\n            switch (direction) {\n                case 'next':\n                    currentstep++;\n                    break;\n                case 'previous':\n                    currentstep--;\n                    break;\n                default:\n                    break;\n            }\n            // eslint-disable-next-line no-console\n            console.log('next step', currentstep);\n\n            loadStep(uniqueid, currentstep);\n        });\n    });\n\n    const container = multiformcontainer.querySelector(SELECTORS.FORMCONTAINER);\n\n    // eslint-disable-next-line no-console\n    console.log(formclass);\n    initializeForm(container, formclass, JSON.parse(data));\n};\n\n/**\n * Load a step of the form via AJAX.\n *\n * @param {mixed} uniqueid\n * @param {mixed} step\n *\n * @return void *\n */\nfunction loadStep(uniqueid, step) {\n    const multiformcontainer = document.querySelector(\n        SELECTORS.MULTISTEPFORMCONTAINER + '[data-uniqueid=\"' + uniqueid + '\"]');\n    if (!multiformcontainer) {\n        // eslint-disable-next-line no-console\n        console.log('multiformcontainer not found');\n        return;\n    }\n\n    Ajax.call([{\n        methodname: 'local_multistepform_load_step',\n        args: {\n            uniqueid: uniqueid,\n            step: step,\n        },\n        done: (response) => {\n\n            // eslint-disable-next-line no-console\n            console.log('response', response);\n\n            Templates.renderForPromise('local_multistepform/multistepform', JSON.parse(response.data)).then(({html, js}) => {\n\n                Templates.replaceNode(SELECTORS.MULTISTEPFORMCONTAINER + '[data-uniqueid=\"' + uniqueid + '\"]', html, js);\n\n                return true;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n        },\n        fail: (error) => {\n            notification.exception(error);\n        },\n    }]);\n}\n\n/**\n * Initialize the form with a template and data.\n *\n * @param {mixed} container\n * @param {mixed} formclass\n * @param {array} data\n *\n * @return [type]\n *\n */\nfunction initializeForm(container, formclass, data = []) {\n\n    // eslint-disable-next-line no-console\n    console.log('dynamicForm', container, formclass, data);\n\n    const uniqueid = container.closest(SELECTORS.MULTISTEPFORMCONTAINER).getAttribute('data-uniqueid');\n\n    if (!dynamicForm) {\n        dynamicForm = new DynamicForm(\n            container,\n            formclass,\n            data,\n        );\n        dynamicForm.load(data);\n    }\n\n    // eslint-disable-next-line no-console\n    console.log('dynamicForm', dynamicForm);\n\n    dynamicForm.addEventListener(dynamicForm.events.FORM_SUBMITTED, e => {\n        const response = e.detail;\n        // eslint-disable-next-line no-console\n        console.log(response);\n        dynamicForm.container.innerHTML = '';\n        dynamicForm = null;\n\n        loadStep(uniqueid, 2);\n    });\n}"],"names":["SELECTORS","dynamicForm","currentstep","loadStep","uniqueid","step","document","querySelector","call","methodname","args","done","response","console","log","renderForPromise","JSON","parse","data","then","_ref","html","js","replaceNode","catch","e","fail","error","notification","exception","initialstep","formclass","multiformcontainer","querySelectorAll","forEach","button","addEventListener","currentTarget","getAttribute","container","closest","DynamicForm","load","events","FORM_SUBMITTED","detail","innerHTML","initializeForm"],"mappings":";;;;;;;8JAcMA,wBACa,uCADbA,iCAEsB,iCAGxBC,YAAc,KACdC,YAAc,WAyDTC,SAASC,SAAUC,MACGC,SAASC,cAChCP,iCAAmC,mBAAqBI,SAAW,oBAOlEI,KAAK,CAAC,CACPC,WAAY,gCACZC,KAAM,CACFN,SAAUA,SACVC,KAAMA,MAEVM,KAAOC,WAGHC,QAAQC,IAAI,WAAYF,6BAEdG,iBAAiB,oCAAqCC,KAAKC,MAAML,SAASM,OAAOC,MAAKC,WAACC,KAACA,KAADC,GAAOA,mCAE1FC,YAAYvB,iCAAmC,mBAAqBI,SAAW,KAAMiB,KAAMC,KAE9F,KACRE,OAAMC,IAELZ,QAAQC,IAAIW,OAGpBC,KAAOC,QACHC,aAAaC,UAAUF,WA1B3Bd,QAAQC,IAAI,8CA5DA,CAACV,SAAU0B,YAAaC,UAAWb,QAGnDL,QAAQC,IAAI,kBAAmBV,SAAU0B,YAAaC,UAAWb,MAGjEL,QAAQC,IAAI,WAAYd,iCAAmC,mBAAqBI,SAAW,YAErF4B,mBAAqB1B,SAASC,cAChCP,iCAAmC,mBAAqBI,SAAW,UAClE4B,+BAEDnB,QAAQC,IAAI,gCAIhBZ,YAAc4B,YAEdE,mBAAmBC,iBAAiB,eAAeC,SAAQC,SACvDA,OAAOC,iBAAiB,SAASX,WAEXA,EAAEY,cAAcC,aAAa,kBAGtC,OACDpC,wBAEC,WACDA,cAMRW,QAAQC,IAAI,YAAaZ,aAEzBC,SAASC,SAAUF,yBAIrBqC,UAAYP,mBAAmBzB,cAAcP,yBAGnDa,QAAQC,IAAIiB,oBA0DQQ,UAAWR,eAAWb,4DAAO,GAGjDL,QAAQC,IAAI,cAAeyB,UAAWR,UAAWb,YAE3Cd,SAAWmC,UAAUC,QAAQxC,kCAAkCsC,aAAa,iBAE7ErC,cACDA,YAAc,IAAIwC,qBACdF,UACAR,UACAb,OAEQwB,KAAKxB,MAIrBL,QAAQC,IAAI,cAAeb,aAE3BA,YAAYmC,iBAAiBnC,YAAY0C,OAAOC,gBAAgBnB,UACtDb,SAAWa,EAAEoB,OAEnBhC,QAAQC,IAAIF,UACZX,YAAYsC,UAAUO,UAAY,GAClC7C,YAAc,KAEdE,SAASC,SAAU,MAnFvB2C,CAAeR,UAAWR,UAAWf,KAAKC,MAAMC"}